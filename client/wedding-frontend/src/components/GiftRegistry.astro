---
const { id = 'registry' } = Astro.props;
---

<section id={id} class="py-8 max-w-screen-md mx-auto">
    <h2 class="text-2xl font-semibold text-center mb-4">Lista de Presentes</h2>
    <div id="gifts" class="space-y-4"></div>
    <script type="module">
        async function load() {
            const res = await fetch('/api/gifts');
            const gifts = await res.json();
            const container = document.getElementById('gifts');
            container.innerHTML = '';
            gifts.forEach(g => {
                const item = document.createElement('div');
                item.className = 'flex justify-between items-center bg-white rounded-lg p-4 shadow';
                item.innerHTML = `<span>${g.name} - R$ ${g.price}</span>` +
                    `<button data-id="${g.id}" class="checkout px-4 py-3 bg-senerity text-white rounded">Comprar</button>`;
                container.appendChild(item);
            });
        }
        document.addEventListener('click', async (e) => {
            if (e.target.matches('.checkout')) {
                const id = e.target.dataset.id;
                const resp = await fetch('/api/checkout/' + id, { method: 'POST' });
                const data = await resp.json();
                if (data.url) window.location.href = data.url;
            }
        });
        load();
    </script>
</section>
